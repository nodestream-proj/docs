<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">One post tagged with &quot;migrations&quot; | Nodestream</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://nodestream-proj.github.io/docs/blog/tags/migrations/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="One post tagged with &quot;migrations&quot; | Nodestream"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://nodestream-proj.github.io/docs/blog/tags/migrations/"><link data-rh="true" rel="alternate" href="https://nodestream-proj.github.io/docs/blog/tags/migrations/" hreflang="en"><link data-rh="true" rel="alternate" href="https://nodestream-proj.github.io/docs/blog/tags/migrations/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/docs/blog/rss.xml" title="Nodestream RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs/blog/atom.xml" title="Nodestream Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-903SETWVRF"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-903SETWVRF",{anonymize_ip:!0})</script><link rel="stylesheet" href="/docs/assets/css/styles.e540dd98.css">
<script src="/docs/assets/js/runtime~main.46cebbb4.js" defer="defer"></script>
<script src="/docs/assets/js/main.8e87fbec.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/nodestream-light.png" alt="Nodestream Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/img/nodestream-light.png" alt="Nodestream Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Nodestream</b></a><a class="navbar__item navbar__link" href="/docs/docs/intro/">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/nodestream-proj/nodestream" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/blog/2025/02/24/nodestream-0-14/">Nodestream 0.14 Release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/blog/2024/08/09/nodestream-0-13/">Nodestream 0.13 Release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/blog/2024/05/14/migrations-evolution/">Migrations Design in Nodestream 0.12</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/blog/2024/04/26/nodestream-neptune-support/">Nodestream Neptune Support</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/blog/2024/04/05/nodestream-0-12/">Nodestream 0.12 Release</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><header class="margin-bottom--xl"><h1>One post tagged with &quot;migrations&quot;</h1><a href="/docs/blog/tags/">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="In the release notes for Nodestream 0.12, we mentioned that we had added support for migrations."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/docs/blog/2024/05/14/migrations-evolution/">Migrations Design in Nodestream 0.12</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-05-14T00:00:00.000Z" itemprop="datePublished">May 14, 2024</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/zprobst" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/zprobst.png" alt="Zach Probst" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/zprobst" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Zach Probst</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of Nodestream</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>In the release notes for Nodestream 0.12, we mentioned that we had added support for migrations.
This is a feature that we have been wanting to add for a long time, and we are excited to finally have it in place.
In this post, we will discuss what migrations are, why they are important, and how they work in Nodestream.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="evolutionary-database-design">Evolutionary Database Design<a href="#evolutionary-database-design" class="hash-link" aria-label="Direct link to Evolutionary Database Design" title="Direct link to Evolutionary Database Design">​</a></h2>
<p>Evolutionary database design is the idea that the database schema should evolve over time as the application changes.
This is in contrast to the traditional approach of creating a fixed schema at the beginning of a project and then never changing it.
With evolutionary database design, the schema is treated as a living document that can be updated and modified as needed.
If you want to go deep into this topic, we recommend reading the <a href="https://martinfowler.com/articles/evodb.html" target="_blank" rel="noopener noreferrer">Martin Fowler&#x27;s page</a> on the subject.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-migrations">Why Migrations?<a href="#why-migrations" class="hash-link" aria-label="Direct link to Why Migrations?" title="Direct link to Why Migrations?">​</a></h2>
<p>Migrations are a way to manage the evolution of the database schema in a controlled and repeatable way.
They allow you to define the changes that need to be made to the schema in a series of files that can be run in sequence.
This makes it easy to track changes to the schema over time and to apply those changes to multiple environments, such as development, staging, and production.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="surveying-all-the-types-of-schema-changes">Surveying All The Types of Schema Changes<a href="#surveying-all-the-types-of-schema-changes" class="hash-link" aria-label="Direct link to Surveying All The Types of Schema Changes" title="Direct link to Surveying All The Types of Schema Changes">​</a></h2>
<p>Graph databases are schema-less, but the data model is still defined by the relationships between nodes and edges and the properties of those nodes and edges.
This means that there is still a schema to manage, even if it is not as rigid as a traditional relational database schema.
Since nodestream is agnostic to the underlying database, we need to be able to support migrations for all types of databases that nodestream can work with.
Therefore we need to support migrations that are designed against an abstract graph model and leave the implementation details to the specific database connector.
So lets examine the types of schema changes that can exist in a graph database:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-new-nodes-and-edges-types">Creating New Nodes and Edges Types<a href="#creating-new-nodes-and-edges-types" class="hash-link" aria-label="Direct link to Creating New Nodes and Edges Types" title="Direct link to Creating New Nodes and Edges Types">​</a></h3>
<p>The most basic type of schema change is creating new node and edge types.
This is equivalent to creating a new table in a relational database.
When you create a new node or edge type, you may need to define the properties that it will have and the relationships that it will have with other nodes and edges.</p>
<p>Depending on the underlying database, this might involve creating a new index or constraint to enforce the uniqueness of the new node or edge type.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="removing-nodes-and-edges-types">Removing Nodes and Edges Types<a href="#removing-nodes-and-edges-types" class="hash-link" aria-label="Direct link to Removing Nodes and Edges Types" title="Direct link to Removing Nodes and Edges Types">​</a></h3>
<p>Conversely, you may also need to remove existing node and edge types.
This is equivalent to dropping a table in a relational database.
Most graph databases do not support leaving orphaned nodes or edges, so you may need to delete all nodes and edges of the type that you are removing.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="adding-properties-to-nodes-and-edges">Adding Properties to Nodes and Edges<a href="#adding-properties-to-nodes-and-edges" class="hash-link" aria-label="Direct link to Adding Properties to Nodes and Edges" title="Direct link to Adding Properties to Nodes and Edges">​</a></h3>
<p>Another common type of schema change is adding properties to existing nodes and edges.
This is equivalent to adding a new column to a table in a relational database.
When you add a property to a node or edge, you may need to define a default value for that property or update existing nodes and edges to have a value for that property.</p>
<p>One tricky case is when you add a property that is part of the nodes or edges key.
In this case, you may need to update the key of the node or edge to include the new property.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="removing-properties-from-nodes-and-edges">Removing Properties from Nodes and Edges<a href="#removing-properties-from-nodes-and-edges" class="hash-link" aria-label="Direct link to Removing Properties from Nodes and Edges" title="Direct link to Removing Properties from Nodes and Edges">​</a></h3>
<p>Conversely, you may also need to remove properties from existing nodes and edges.
This is equivalent to dropping a column from a table in a relational database.
When you remove a property from a node or edge, you may need to update existing nodes and edges to remove the value for that property.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="adding-and-removing-indexes">Adding and Removing Indexes<a href="#adding-and-removing-indexes" class="hash-link" aria-label="Direct link to Adding and Removing Indexes" title="Direct link to Adding and Removing Indexes">​</a></h3>
<p>Another common type of schema change is adding and removing indexes.
Indexes are used to speed up queries by allowing the database to quickly find nodes and edges that match certain criteria.
When you add an index, you may need to define the properties that the index will be based on and the type of index that will be used.
When you remove an index, you may need to update existing indexes to remove the properties that the index was based on.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="topological-changes">Topological Changes<a href="#topological-changes" class="hash-link" aria-label="Direct link to Topological Changes" title="Direct link to Topological Changes">​</a></h3>
<p>Finally, you may need to make topological changes to the schema such as adding or removing relationships between nodes and edges.
This is equivalent to adding or removing foreign keys in a relational database.</p>
<p>When you change the adjancency of nodes and edges, you may want to clean up the data to ensure that it is consistent with the new schema.
This may involve updating existing nodes and edges to reflect the new relationships or deleting nodes and edges that are no longer needed.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-migrations-work-in-nodestream">How Migrations Work in Nodestream<a href="#how-migrations-work-in-nodestream" class="hash-link" aria-label="Direct link to How Migrations Work in Nodestream" title="Direct link to How Migrations Work in Nodestream">​</a></h2>
<p>In nodestream, migrations are defined as a series of yaml files that describe the changes that need to be made to the schema.
Each migration file contains a list of operations that need to be performed.
For example, creating a new node type or adding a property to an existing node type.</p>
<p>When you run <code>nodestream migrations make</code> nodestream will create a new migration file in the <code>migrations</code> directory.
That process works roughly like this:</p>
<ul>
<li>Nodestream will look at the current state of the schema by initializing and introspecting all pipelines (A).</li>
<li>Build the state of the schema that is represented by the current migrations (B).</li>
<li>Diff the two states (A and B) to determine the changes that need to be made to the schema.</li>
<li>Generate a new migration file that describes the changes that need to be made to the schema.</li>
</ul>
<p>When you run <code>nodestream migrations run</code> nodestream will apply the migrations in sequence to evolve the schema.
That process works roughly like this:</p>
<ul>
<li>Nodestream reads the migration files into memory and builds a graph of the dependencies between the migrations.</li>
<li>Nodestream runs the migrations in topological order, applying the changes to the schema as it goes.</li>
<li>Nodestream keeps track of which migrations have been applied so that it can skip them in the future.</li>
</ul>
<p>Crucially, nodestream does not track all possible schema changes.
Topological changes are not tracked(see <a href="#topological-changes">here</a>), so you will need to handle those manually.
Additionally, nodestream does not support rolling back migrations, so you will need to handle that manually as well.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="are-migrations-any-good">Are Migrations Any Good?<a href="#are-migrations-any-good" class="hash-link" aria-label="Direct link to Are Migrations Any Good?" title="Direct link to Are Migrations Any Good?">​</a></h2>
<p>Wondering what Martin Fowler would think of this design given is <a href="https://martinfowler.com/articles/evodb.html" target="_blank" rel="noopener noreferrer">page on the subject</a>?
He describes the concept of &quot;evolutionary database design&quot; with a set of characterisitcs.
Some of them are more organizational than technical.</p>
<p>However, some of the technical ones are:</p>
<ul>
<li><strong>All Database Artifacts are Version Controlled with Application Code:</strong> Nodestream&#x27;s migrations are intended to be source controlled files that are run in sequence and define their dependencies. This makes it easy to evolve changes and continuously integrate them (which is another of the characteristics).</li>
<li><strong>All database changes are database refactorings</strong> Nodestream&#x27;s migrations are a series of database refactorings that are run in sequence. This makes it easy to track changes to the schema over time and to apply those changes to multiple environments, such as development, staging, and production. We are detecting the changes that need to be made to the schema and applying them in a controlled and repeatable way.</li>
<li><strong>Clearly Separate Database Access Code</strong> You generally don&#x27;t need to write database access code in nodestream, so this is taken care of <!-- -->🎆</li>
<li><strong>Automated the Refactorings</strong> This is the main point of migrations. They are automated and can be run in sequence to evolve the schema.</li>
</ul>
<p>We are happy with the design of the migrations in nodestream and we think that they are a good fit for the project.
As we&#x27;ve mentioned, there are still some major evolutions to be made to migrations, such as the ability to rollback a migration, but we are confident that we are on the right track.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/blog/tags/migrations/">migrations</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/blog/tags/nodestream/">nodestream</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/docs/intro/">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/orgs/nodestream-proj/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/nodestream-proj/nodestream" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Nodestream Project.</div></div></div></footer></div>
</body>
</html>